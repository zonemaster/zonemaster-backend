dist: focal

language: perl

jobs:
  include:
    - stage: check-manifest
      perl: "5.32"
      script:
        - perl Makefile.PL
        - touch unknown.file
        - if make distcheck |& grep -i "Not in MANIFEST"; then exit 1; fi
    - stage: test
      - perl: "5.32"
        env: TARGET=SQLite ZONEMASTER_RECORD=0 ZONEMASTER_BACKEND_CONFIG_FILE=./share/travis_sqlite_backend_config.ini
      - perl: "5.16"
        dist: bionic
        env: TARGET=SQLite ZONEMASTER_RECORD=0 ZONEMASTER_BACKEND_CONFIG_FILE=./share/travis_sqlite_backend_config.ini

script:
    - perl Makefile.PL
    - if make distcheck |& grep -i "Not in MANIFEST"; then exit 1; fi
    - make test TEST_VERBOSE=1
